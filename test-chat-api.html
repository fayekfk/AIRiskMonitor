<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Chat API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:disabled {
            background: #ccc;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            background: #f5f5f5;
        }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Test Chat API from GitHub Pages</h1>
    <p>This will test if the chat API works from your GitHub Pages domain.</p>
    
    <button onclick="testAPI()">Test API</button>
    <button onclick="testCORS()">Test CORS</button>
    
    <div id="result"></div>

    <script>
        const API_URL = 'https://air-isk-monitor-api.vercel.app/api/openai';
        
        async function testAPI() {
            const result = document.getElementById('result');
            result.innerHTML = '⏳ Testing API...';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'You are a helpful assistant.' },
                            { role: 'user', content: 'Say "Chat API is working!" if you can read this.' }
                        ],
                        model: 'gpt-4o-mini',
                        temperature: 0.7,
                        max_tokens: 50
                    })
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers.entries()]);

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                console.log('Response data:', data);

                const content = data?.choices?.[0]?.message?.content || 'No content';

                result.innerHTML = `<span class="success">✅ SUCCESS!</span>\n\nAI Response: ${content}\n\nFull Response:\n${JSON.stringify(data, null, 2)}`;

            } catch (error) {
                console.error('Error:', error);
                result.innerHTML = `<span class="error">❌ ERROR</span>\n\n${error.message}\n\nCheck browser console (F12) for more details.`;
            }
        }

        async function testCORS() {
            const result = document.getElementById('result');
            result.innerHTML = '⏳ Testing CORS...';
            
            try {
                // Test OPTIONS request (CORS preflight)
                const response = await fetch(API_URL, {
                    method: 'OPTIONS',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                console.log('CORS Preflight status:', response.status);
                console.log('CORS Headers:', [...response.headers.entries()]);

                const corsHeaders = {
                    'Access-Control-Allow-Origin': response.headers.get('Access-Control-Allow-Origin'),
                    'Access-Control-Allow-Methods': response.headers.get('Access-Control-Allow-Methods'),
                    'Access-Control-Allow-Headers': response.headers.get('Access-Control-Allow-Headers'),
                };

                result.innerHTML = `<span class="success">✅ CORS Test Complete</span>\n\nCORS Headers:\n${JSON.stringify(corsHeaders, null, 2)}\n\nStatus: ${response.status}`;

            } catch (error) {
                console.error('CORS Error:', error);
                result.innerHTML = `<span class="error">❌ CORS ERROR</span>\n\n${error.message}\n\nThis means the API is blocking requests from this domain.`;
            }
        }

        // Log current page URL
        console.log('Testing from:', window.location.href);
    </script>
</body>
</html>

